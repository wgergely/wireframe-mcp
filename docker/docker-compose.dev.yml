# Development overrides for wireframe-mcp
# Enables hot reloading by mounting source code as a volume
#
# Usage:
#   docker compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml up --build
#   docker compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml run wireframe-mcp test -v
#
# Hot reloading:
#   - Source code is mounted from host, not copied into image
#   - Changes to src/ are immediately reflected in the container
#   - No rebuild required for code changes (only for dependency changes)

services:
  wireframe-mcp:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: dev
    image: wireframe-mcp:dev
    container_name: wireframe-mcp-dev
    # Keep container alive for interactive development
    # Run commands with: docker exec wireframe-mcp-dev python . {command}
    entrypoint: ["/bin/sh", "-c"]
    command: ["echo 'Dev container ready. Use docker exec to run commands.' && tail -f /dev/null"]
    volumes:
      # Mount source code for hot reloading (overrides base volumes)
      - ../src:/app/src:ro
      - ../__main__.py:/app/__main__.py:ro
      - ../conftest.py:/app/conftest.py:ro
      - ../pytest.ini:/app/pytest.ini:ro
      # Named volumes for persistent data (from base)
      - wireframe-corpus-data:/app/corpus/data:rw
      - wireframe-corpus-models:/app/corpus/models:rw
      - wireframe-output:/app/data:rw
    environment:
      - LOG_LEVEL=DEBUG
      - PYTHONDONTWRITEBYTECODE=1
    # Override healthcheck for faster dev iteration
    healthcheck:
      test: ["CMD", "python", "-c", "import src"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 5s
