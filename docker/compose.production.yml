# Production overrides for wireframe-mcp
#
# Optimized for deployment with GPU support and security hardening.
# Container name: wfmcp-server (production is the default identity)
#
# Features:
#   - Source code baked into image (no host mounts)
#   - GPU passthrough enabled via NVIDIA runtime
#   - Production logging level
#   - Kroki internal-only (no exposed ports)
#   - Resource limits configured
#
# Usage:
# Usage:
#   docker compose -f compose.base.yml \
#                  -f compose.core.yml \
#                  -f compose.renderer.yml \
#                  -f compose.production.yml up -d

services:
  wfmcp-server:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: prod
    image: wireframe-mcp:prod
    # Production uses base name (no suffix)
    container_name: wfmcp-server
    environment:
      - LOG_LEVEL=INFO
    # GPU support via NVIDIA Container Toolkit
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    # Production healthcheck
    healthcheck:
      test: [ "CMD", "python", "-c", "from src import list_providers; list_providers()" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

  wfmcp-kroki:
    # Kroki in production: no exposed ports, internal network only
    ports: []
